                        IFR步兵程序说明文档
一、工程名称：IFR_Hero_2018

二、文件夹：
　　　KEIL：编译环境IDE
　　　STM32MCU:stm32相关支持文件
　　　USER:主函数
　　　ROBOT:步兵控制的相关文件
　　　   BSP:板级初始化文件
　　　   APP：机器人控制应用文件
　　　   ALGO:机器人算法文件
　　　   MODULE:机器人外接模块
　　　      MPU6050:mpu6050相关文件
　　　
三、键位操纵（暂定）：
任何模式下，鼠标及遥控器偏航通道仅控制云台目标姿态角，底盘实施跟随
Q,E分别为左转、右转90度


任务日志：
2018.2.30 
待完善：
1.云台漂移问题
解决方案：静态车身位置环+车身矫正或全局陀螺仪位置环或静态陀螺仪位置环+动态速度环
该版本：采用全陀螺仪位置环方案
2.升降信息传入
解决方案：陀螺仪、电机姿态融合或底盘独立陀螺仪
实验中
3.标定问题
解决方案：增加陀螺仪融合输出
已写，存在问题
4.程序跑飞
解决方案：看门狗
暂未添加
5.程序自保护
解决方案：实时监测帧率，模块掉线进入自保护状态，模块上线重新标定检测（遥控器）；检测输出信息，自检程序防疯
已添加
待写：
自动取弹


4.18待解决问题：云台基于电机反馈的控制，用于登岛时看小屏幕或者冗余控制系统
			   高速前进转向时的超调难以回中现象
5.10待解决:云台鼠标控制角度是整形虽然内部累加是浮点但是输出还是整形，导致鼠标进行长时间移动后云台会突然变化1度而不是连续变化

对于底盘跟随的算法猜想：
接近底盘处减小VW，变速PID

对于变速跟随KP与启动自校正的矛盾
可以仅在ERROR绝对值下降区进行变速KP，上升去不去

注意在自动登岛时取消变速PID
/************************/
第一版陀螺仪
typedef struct GYRO_Struct
{
	int16_t acc[3];
	int16_t angvel[3];
	float angle[3];
}GYRO_DATA;

extern GYRO_DATA Gyro_Data;

/************************/
第二版陀螺仪


图传切换，低电平是取弹


5.10待解决，上岛	5.11已解决（传感器插反了，标签纸写错了）


操作设计：
UP-*:全手动模式（NORMAL_STATE）	-UP UP：一起上升下降		-UP DOWN 差值上升下降
MID-MID:STOP_STATE		
MID-UP(跳变)：全自动上岛		
MID-DOWN（跳变）：全自动下岛
DOWN-*:TAKEBULLET_STATE（跳变时旋转180，并将底盘升起）（整个取弹模式摄像头自动切换，操作自动反向（不过还是要写图传向前时操作模式顺应改变））（切出取弹模式自动图传转向，操作模式改变，自动进行取弹一系列流程等等）

CTRL键按住时
